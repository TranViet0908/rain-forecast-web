<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Khoa H·ªçc & M√¥ H√¨nh - RainAI</title>
    <link rel="stylesheet" href="/css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/animejs@3/lib/anime.min.js"></script>
    <style>
        .method-container {
            max-width: 1000px; margin: 40px auto; padding: 0 20px;
        }
        .tech-card {
            background: rgba(255,255,255,0.9); border-radius: 16px; padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); margin-bottom: 30px;
        }
        .tech-header {
            font-size: 1.5rem; font-weight: 700; color: #1e293b; margin-bottom: 20px;
            display: flex; align-items: center; gap: 10px;
        }
        .metric-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;
        }
        .metric-box {
            background: #f8fafc; padding: 20px; border-radius: 12px; text-align: center; border: 1px solid #e2e8f0;
        }
        .metric-val { font-size: 2rem; font-weight: 800; color: #0284c7; }
        .metric-lbl { color: #64748b; font-size: 0.9rem; text-transform: uppercase; margin-top: 5px; }
    </style>
</head>
<body>
<div th:replace="fragments/header :: header"></div>

<main class="method-container">
    <div class="page-hero" style="padding: 40px 0; margin-bottom: 20px;">
        <h1 class="hero-title">C√¥ng Ngh·ªá L√µi</h1>
        <p class="hero-desc">S·ª± k·∫øt h·ª£p gi·ªØa D·ªØ li·ªáu v·ªá tinh (LST) v√† Machine Learning (Random Forest)</p>
    </div>

    <!-- 1. HI·ªÜU SU·∫§T M√î H√åNH -->
    <div class="tech-card">
        <div class="tech-header">üöÄ Hi·ªáu Su·∫•t M√¥ H√¨nh (Real-time)</div>
        <div class="metric-grid" th:if="${modelInfo != null}">
            <div class="metric-box">
                <div class="metric-val" th:text="${modelInfo.metrics['accuracy_gatekeeper']} + '%'">0%</div>
                <div class="metric-lbl">ƒê·ªô ch√≠nh x√°c ph√¢n lo·∫°i (M∆∞a/Kh√¥ng)</div>
            </div>
            <div class="metric-box">
                <div class="metric-val" th:text="${modelInfo.metrics['r2_score_specialist']}">0.0</div>
                <div class="metric-lbl">R2 Score (ƒê·ªô kh·ªõp l∆∞·ª£ng m∆∞a)</div>
            </div>
            <div class="metric-box">
                <div class="metric-val">15,000+</div>
                <div class="metric-lbl">M·∫´u d·ªØ li·ªáu hu·∫•n luy·ªán (1984-2024)</div>
            </div>
        </div>
        <div th:unless="${modelInfo != null}" style="text-align: center; color: red;">
            Kh√¥ng th·ªÉ k·∫øt n·ªëi t·ªõi Model Python Server.
        </div>
    </div>

    <!-- 2. BI·ªÇU ƒê·ªí FEATURE IMPORTANCE -->
    <div class="tech-card">
        <div class="tech-header">üìä Y·∫øu T·ªë ·∫¢nh H∆∞·ªüng Nh·∫•t</div>
        <p style="color: #64748b; margin-bottom: 20px;">
            Bi·ªÉu ƒë·ªì d∆∞·ªõi ƒë√¢y cho th·∫•y AI "coi tr·ªçng" y·∫øu t·ªë n√†o nh·∫•t khi ƒë∆∞a ra quy·∫øt ƒë·ªãnh d·ª± b√°o m∆∞a.
            D·ªØ li·ªáu ƒë∆∞·ª£c tr√≠ch xu·∫•t tr·ª±c ti·∫øp t·ª´ c·∫•u tr√∫c c√¢y quy·∫øt ƒë·ªãnh c·ªßa m√¥ h√¨nh.
        </p>
        <div style="height: 400px; position: relative;">
            <canvas id="featureChart"></canvas>
        </div>
    </div>

    <!-- 3. GI·∫¢I TH√çCH LST -->
    <div class="tech-card">
        <div class="tech-header">üõ∞Ô∏è Land Surface Temperature (LST) l√† g√¨?</div>
        <div style="display: flex; gap: 20px; flex-wrap: wrap;">
            <div style="flex: 1; min-width: 300px;">
                <p><strong>Nhi·ªát ƒë·ªô b·ªÅ m·∫∑t ƒë·∫•t (LST)</strong> kh√°c v·ªõi nhi·ªát ƒë·ªô kh√¥ng kh√≠ m√† ch√∫ng ta c·∫£m nh·∫≠n. N√≥ l√† nhi·ªát ƒë·ªô l·ªõp ngo√†i c√πng c·ªßa tr√°i ƒë·∫•t, ƒë∆∞·ª£c ƒëo b·∫±ng c·∫£m bi·∫øn h·ªìng ngo·∫°i t·ª´ v·ªá tinh.</p>
                <p>Trong d·ª± √°n n√†y, LST ƒë√≥ng vai tr√≤ quan tr·ªçng v√¨:</p>
                <ul style="margin-left: 20px; line-height: 1.6; color: #475569;">
                    <li>Gi√∫p ph√°t hi·ªán s·ª± b·ªëc h∆°i n∆∞·ªõc t·ª´ m·∫∑t ƒë·∫•t (nguy√™n li·ªáu t·∫°o m√¢y).</li>
                    <li>T∆∞∆°ng quan ch·∫∑t ch·∫Ω v·ªõi ƒë·ªô ·∫©m ƒë·∫•t tr∆∞·ªõc khi m∆∞a.</li>
                    <li>Cung c·∫•p d·ªØ li·ªáu chi ti·∫øt h∆°n so v·ªõi c√°c tr·∫°m kh√≠ t∆∞·ª£ng th∆∞a th·ªõt.</li>
                </ul>
            </div>
            <div style="flex: 1; min-width: 300px; background: #e2e8f0; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                <!-- Placeholder ·∫£nh LST -->
                <div style="text-align: center; padding: 20px;">
                    <div style="font-size: 3rem;">üõ∞Ô∏è üì°</div>
                    <div style="margin-top: 10px; color: #64748b;">M√¥ ph·ªèng d·ªØ li·ªáu v·ªá tinh</div>
                </div>
            </div>
        </div>
    </div>
</main>

<script th:inline="javascript">
    /*<![CDATA[*/
    document.addEventListener("DOMContentLoaded", function() {
        const modelInfo = /*[[${modelInfo}]]*/ null;

        if (modelInfo && modelInfo.feature_importance) {
            const ctx = document.getElementById('featureChart');
            const labels = modelInfo.feature_importance.slice(0, 10).map(f => f.name); // Top 10
            const data = modelInfo.feature_importance.slice(0, 10).map(f => f.score);

            // Mapping t√™n cho ƒë·∫πp
            const nameMap = {
                'lst': 'Nhi·ªát ƒë·ªô b·ªÅ m·∫∑t (LST)',
                'humidity': 'ƒê·ªô ·∫©m',
                'rain_lag_1': 'M∆∞a h√¥m qua',
                'rain_mean_3d': 'TB M∆∞a 3 ng√†y',
                'dew_point': 'ƒêi·ªÉm s∆∞∆°ng',
                'temperature': 'Nhi·ªát ƒë·ªô KK',
                'wind_speed': 'T·ªëc ƒë·ªô gi√≥',
                'heat_index': 'Ch·ªâ s·ªë nhi·ªát',
                'lat': 'Vƒ© ƒë·ªô', 'lon': 'Kinh ƒë·ªô'
            };
            const niceLabels = labels.map(l => nameMap[l] || l);

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: niceLabels,
                    datasets: [{
                        label: 'M·ª©c ƒë·ªô ·∫£nh h∆∞·ªüng (%)',
                        data: data.map(x => (x * 100).toFixed(2)),
                        backgroundColor: 'rgba(59, 130, 246, 0.6)',
                        borderColor: 'rgb(59, 130, 246)',
                        borderWidth: 1,
                        borderRadius: 6
                    }]
                },
                options: {
                    indexAxis: 'y', // Bi·ªÉu ƒë·ªì ngang
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { x: { beginAtZero: true } }
                }
            });
        }

        // Animation
        anime({
            targets: '.tech-card',
            translateY: [20, 0], opacity: [0, 1],
            delay: anime.stagger(100), easing: 'easeOutQuad'
        });
    });
    /*]]>*/
</script>
</body>
</html>